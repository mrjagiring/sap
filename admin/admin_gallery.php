<?phpinclude("config.php");include("config.inc.php");include("fc/tglibrary.php");include("fc/function.php");$go=$_GET['go'];$del=$_GET['del'];$uploadfolder=$_POST['uploadfolder'];if($_POST['newalbum']){	$name=$_POST['name'];	if(!$name){	echo"<fieldset><legend style=font-family:helvetica;font-weight:bold;font-weigth:bold;>Confirmation</legend><table style=font-family:helvetica;font-weigth:bold;font-size:12px;>";	echo"<tr><td>Please fill all coloum<a href=admin_gallery.php style=float:right;text-decoration:none;>Back</a></td></tr>";	echo"</table></fieldset>";	die();	}	mysqli_query($mysqli1,"insert into `data_galleryfolder` set `name`='$name'");	echo"<fieldset><legend style=font-family:helvetica;font-weight:bold;font-weigth:bold;>Confirmation</legend><table style=font-family:helvetica;font-weigth:bold;font-size:12px;>";	echo"<tr><td>Success add new album<a href=admin_gallery.php style=float:right;text-decoration:none;>Back</a></td></tr>";	echo"</table></fieldset>";	die();}if($add){}if($del){	$ARRAYdata_galleryfolder=mysqli_fetch_array(mysqli_query($mysqli1,"select * from `data_galleryfolder` where `id`='$del'"));	$TAKEdata_gallery=mysqli_query($mysqli1,"select * from `data_gallery` where `folder`='$ARRAYdata_galleryfolder[name]'");	while($ARRAYdata_gallery=mysqli_fetch_array($TAKEdata_gallery)){	$file1="../images/gallery/".$ARRAYdata_gallery['folder']."/photo/".$ARRAYdata_gallery['url']."";	$file2="../images/gallery/".$ARRAYdata_gallery['folder']."/thumb/".$ARRAYdata_gallery['url']."";	unlink("$file1");	unlink("$file2");	mysqli_query($mysqli1,"delete from `data_gallery` where `id`='$ARRAYdata_gallery[id]'");	}	mysqli_query($mysqli1,"delete from `data_galleryfolder` where `id`='$del'");	echo"<fieldset><legend style=font-family:helvetica;font-weight:bold;font-weigth:bold;>Confirmation</legend><table style=font-family:helvetica;font-weigth:bold;font-size:12px;>";	echo"<tr><td>Success delete album and the picture inside<a href=admin_gallery.php style=float:right;text-decoration:none;>Back</a></td></tr>";	echo"</table></fieldset>";	die();}if($go=='addalbumpic'){	$id=$_GET[id];	$ARRAYdata_galleryfolder=mysqli_fetch_array(mysqli_query($mysqli1,"select * from `data_galleryfolder` where `id`='$id'"));	echo"<table border=0 style=\"BORDER-RIGHT: black 2px solid; BORDER-TOP: black 2px solid; BORDER-LEFT: black 2px solid; BORDER-BOTTOM: black 2px solid;font-family:helvetica;font-weight:bold;font-size:12px;text-align:center;width:100%;\"><form action=".$_SERVER['PHP_SELF']." method=\"post\" enctype=\"multipart/form-data\">";	echo"<tr style=background-color:black;color:white;><td>Add picture to album $ARRAYdata_galleryfolder[name]</td></tr>";	echo"<tr><td>Add New Photo : <input type=\"file\" name=\"upload\" id=\"upload\" size=\"33\" style=width:100%;></td></tr>";	echo"<tr><td>Title : <input type=text maxlength=200; name=title style=width:100%;></td></tr>";	echo"<tr><td>Desc : <textarea name=desc style=overflow:auto;width:100%; rows=10></textarea></td></tr>";	echo"<tr><td><input type=submit name=Submit id=Submit value='Upload' style=float:right;background-color:white;></td></tr>";	echo"<input type=hidden name=uploadfolder value='$ARRAYdata_galleryfolder[name]'>";	echo"</form></table>";	die();}if($go=='delalbumpic'){	$id=$_GET[id];	$ARRAYdata_gallery=mysqli_fetch_array(mysqli_query($mysqli1,"select * from `data_gallery` where `id`='$id'"));	$file1="../images/gallery/".$ARRAYdata_gallery['folder']."/photo/".$ARRAYdata_gallery['url']."";	$file2="../images/gallery/".$ARRAYdata_gallery['folder']."/thumb/".$ARRAYdata_gallery['url']."";	unlink("$file1");	unlink("$file2");	mysqli_query($mysqli1,"delete from `data_gallery` where `id`='$id'");	echo"<fieldset><legend style=font-family:helvetica;font-weight:bold;font-weigth:bold;>Confirmation</legend><table style=font-family:helvetica;font-weigth:bold;font-size:12px;>";	echo"<tr><td>Success delete picture<a href=admin_gallery.php style=float:right;text-decoration:none;>Back</a></td></tr>";	echo"</table></fieldset>";	die();}?><script type="text/javascript" src="js/prototype.js"></script><script type="text/javascript" src="js/scriptaculous.js?load=effects,builder"></script><script type="text/javascript" src="js/lightbox.js"></script><link rel="stylesheet" href="css/lightbox.css" type="text/css" media="screen" /><?phpinclude ($_SERVER['DOCUMENT_ROOT'].$foldername."/admin/upload_class/upload_class.php"); error_reporting(E_ALL);ini_set("memory_limit", "64M");set_time_limit(60);class Foto_upload extends file_upload {		var $x_size;	var $y_size;	var $x_max_size = 300;	var $y_max_size = 200;	var $x_max_thumb_size = 110;	var $y_max_thumb_size = 88;	var $thumb_folder;	var $foto_folder;	var $larger_dim;	var $larger_curr_value;	var $larger_dim_value;	var $larger_dim_thumb_value;		var $use_image_magick = false; // switch between true and false	// I suggest to use ImageMagick on Linux/UNIX systems, it works on windows too, but it's hard to configurate	// check your existing configuration by your web hosting provider		function process_image($landscape_only = false, $create_thumb = false, $delete_tmp_file = false, $compression = 85) {		$filename = $this->upload_dir.$this->file_copy;		$this->check_dir($this->thumb_folder); // run these checks to create not existing directories		$this->check_dir($this->foto_folder); // the upload dir is created during the file upload (if not already exists)		$thumb = $this->thumb_folder.$this->file_copy;		$foto = $this->foto_folder.$this->file_copy;		if ($landscape_only) {			$this->get_img_size($filename);			if ($this->y_size > $this->x_size) {				$this->img_rotate($filename, $compression);			}		}		$this->check_dimensions($filename); // check which size is longer then the max value		if ($this->larger_curr_value > $this->larger_dim_value) {			$this->thumbs($filename, $foto, $this->larger_dim_value, $compression);		} else {			copy($filename, $foto);		}		if ($create_thumb) {			if ($this->larger_curr_value > $this->larger_dim_thumb_value) {				$this->thumbs($filename, $thumb, $this->larger_dim_thumb_value, $compression); // finally resize the image			} else {				copy($filename, $thumb);			}		}		if ($delete_tmp_file) $this->del_temp_file($filename); // note if you delete the tmp file the check if a file exists will not work	}	function get_img_size($file) {		$img_size = getimagesize($file);		$this->x_size = $img_size[0];		$this->y_size = $img_size[1];	}	function check_dimensions($filename) {		$this->get_img_size($filename);		$x_check = $this->x_size - $this->x_max_size;		$y_check = $this->y_size - $this->y_max_size;		if ($x_check < $y_check) {			$this->larger_dim = "y";			$this->larger_curr_value = $this->y_size;			$this->larger_dim_value = $this->y_max_size;			$this->larger_dim_thumb_value = $this->y_max_thumb_size;		} else {			$this->larger_dim = "x";			$this->larger_curr_value = $this->x_size;			$this->larger_dim_value = $this->x_max_size;			$this->larger_dim_thumb_value = $this->x_max_thumb_size;		}	}	function img_rotate($wr_file, $comp) {		$new_x = $this->y_size;		$new_y = $this->x_size;		if ($this->use_image_magick) {			exec(sprintf("mogrify -rotate 90 -quality %d %s", $comp, $wr_file));		} else {			$src_img = imagecreatefromjpeg($wr_file);			$rot_img = imagerotate($src_img, 90, 0);			$new_img = imagecreatetruecolor($new_x, $new_y);			imageantialias($new_img, TRUE);			imagecopyresampled($new_img, $rot_img, 0, 0, 0, 0, $new_x, $new_y, $new_x, $new_y);			imagejpeg($new_img, $this->upload_dir.$this->file_copy, $comp);		}	}	function thumbs($file_name_src, $file_name_dest, $target_size, $quality = 80) {		//print_r(func_get_args());		$size = getimagesize($file_name_src);		if ($this->larger_dim == "x") {			$w = number_format($target_size, 0, ',', '');			$h = number_format(($size[1]/$size[0])*$target_size,0,',','');		} else {			$h = number_format($target_size, 0, ',', '');			$w = number_format(($size[0]/$size[1])*$target_size,0,',','');		}		if ($this->use_image_magick) {			exec(sprintf("convert %s -resize %dx%d -quality %d %s", $file_name_src, $w, $h, $quality, $file_name_dest));		} else {			$dest = imagecreatetruecolor($w, $h);			imageantialias($dest, TRUE);			$src = imagecreatefromjpeg($file_name_src);			imagecopyresampled($dest, $src, 0, 0, 0, 0, $w, $h, $size[0], $size[1]);			imagejpeg($dest, $file_name_dest, $quality);		}	}}$max_size = 1024*1024; // the max. size for uploading (~1MB)define("MAX_SIZE", $max_size);$foto_upload = new Foto_upload;$foto_upload->upload_dir = $_SERVER['DOCUMENT_ROOT'].$foldername."/images/gallery/".$uploadfolder.""; // "files" is the folder for the uploaded files (you have to create these folder)$foto_upload->foto_folder = $_SERVER['DOCUMENT_ROOT'].$foldername."/images/gallery/".$uploadfolder."/photo/";$foto_upload->thumb_folder = $_SERVER['DOCUMENT_ROOT'].$foldername."/images/gallery/".$uploadfolder."/thumb/";$foto_upload->extensions = array(".jpg"); // specify the allowed extension(s) here$foto_upload->language = "en";$foto_upload->x_max_size = 480;$foto_upload->y_max_size = 384;$foto_upload->x_max_thumb_size = 150;$foto_upload->y_max_thumb_size = 100;$today=date("hms");if (isset($_POST['Submit']) && $_POST['Submit'] == "Upload") {	$title=$_POST['title'];	$desc=$_POST['desc'];	$namafoto=$today.$_FILES['upload']['name'];	$namafoto=str_replace(" ","_",$namafoto);	$foto_upload->the_temp_file = $_FILES['upload']['tmp_name'];	$foto_upload->the_file = $namafoto;	$foto_upload->http_error = $_FILES['upload']['error'];	$foto_upload->replace = (isset($_POST['replace'])) ? $_POST['replace'] : "n"; // because only a checked checkboxes is true	$foto_upload->do_filename_check = "n"; 	if(!$title or !$desc or strlen($namafoto)<=6){	echo"<fieldset><legend style=font-family:helvetica;font-weight:bold;font-weigth:bold;>Confirmation</legend><table style=font-family:helvetica;font-weigth:bold;font-size:12px;>";	echo"<tr><td>Please fill all coloum<a href=admin_gallery.php style=float:right;text-decoration:none;>Back</a></td></tr>";	echo"</table></fieldset>";	die();	}	if ($foto_upload->upload()) {	$foto_upload->process_image(false, true, true, 80);	$foto_upload->message[] = "Processed foto: ".$foto_upload->file_copy."!"; // "file_copy is the name of the foto"	mysqli_query($mysqli1,"insert into `data_gallery` set `title`='$title',`desc`='$desc',`url`='$namafoto',`folder`='$uploadfolder'");	echo"<fieldset><legend style=font-family:helvetica;font-weight:bold;font-weigth:bold;>Confirmation</legend><table style=font-family:helvetica;font-weigth:bold;font-size:12px;>";	echo"<tr><td>Success upload new photo<a href=admin_gallery.php style=float:right;text-decoration:none;>Back</a></td></tr>";	echo"</table></fieldset>";	die();	}}$error = $foto_upload->show_error_string();	$TAKEdata_gallery=mysqli_query($mysqli1,"select * from `data_gallery`");	echo"<fieldset><legend style=font-family:verdana;font-weigth:bold;>Gallery Edit</legend><form action=".$_SERVER['PHP_SELF']." method=\"post\" enctype=\"multipart/form-data\"><table border=0 style=font-family:helvetica;font-weight:bold;font-size:12px;text-align:center;>";	echo"<tr><td colspan=2><a href=admin_gallery.php?go=newgal>New Gallery</a>&nbsp;&nbsp;<a href=admin_gallery.php?go=viewgal>View Gallery</a></td></tr></table>";	if($go=='viewgal'){		echo"<table border=0 style=\"BORDER-RIGHT: black 2px solid; BORDER-TOP: black 2px solid; BORDER-LEFT: black 2px solid; BORDER-BOTTOM: black 2px solid;font-family:helvetica;font-weight:bold;font-size:12px;text-align:center;\"><tr style=background-color:black;color:white;font-size:14px;><td style=width=200px;>Gallery</td><td style=width=200px;>Action</td></tr>";		$TAKEdata_galleryfolder=mysqli_query($mysqli1,"select * from `data_galleryfolder`");		while($ARRAYdata_galleryfolder=mysqli_fetch_array($TAKEdata_galleryfolder)){			echo"<tr><td>$ARRAYdata_galleryfolder[name]</td><td><a href=admin_gallery.php?go=addalbumpic&id=$ARRAYdata_galleryfolder[id]>add</a> || <a href=admin_gallery.php?go=viewalbum&id=$ARRAYdata_galleryfolder[id]>view</a> || <a href=admin_gallery.php?del=$ARRAYdata_galleryfolder[id]>delete</a></td></tr>";		}	echo"</table></fieldset>";	}	if($go=='newgal'){		echo"<table border=0 style=\"BORDER-RIGHT: black 2px solid; BORDER-TOP: black 2px solid; BORDER-LEFT: black 2px solid; BORDER-BOTTOM: black 2px solid;font-family:helvetica;font-weight:bold;font-size:12px;text-align:center;\"><form method=post action=admin_gallery.php>		<tr style=background-color:black;color:white;font-size:14px;><td>Create New Album</td></tr>		<tr><td>Name : <input type=text name=name></td></tr>		<tr style=background-color:black;color:white;font-size:14px;><td><input type=submit style=float:right; value=submit name=newalbum></td></tr>";	echo"</form></table></fieldset>";	}	if($go=='viewalbum'){		$id=$_GET['id'];		$no=1;		echo"<table border=0 style=\"BORDER-RIGHT: black 2px solid; BORDER-TOP: black 2px solid; BORDER-LEFT: black 2px solid; BORDER-BOTTOM: black 2px solid;font-family:helvetica;font-weight:bold;font-size:12px;text-align:center;\"><tr style=background-color:black;color:white;><td width=50>No.</td><td width=200>Picture</td><td width=200>Title</td><td width=200>Desc</td><td width=200>Action</td></tr>";		$TAKEdata_gallery=mysqli_query($mysqli1,"select t1.* from `data_gallery` as t1,`data_galleryfolder` as t2 where t1.folder=t2.name and t2.id='$id'");		while($ARRAYdata_gallery=mysqli_fetch_array($TAKEdata_gallery)){			echo"<tr><td>$no</td><td><IMG SRC=\"../images/gallery/$ARRAYdata_gallery[folder]/thumb/$ARRAYdata_gallery[url]\" BORDER=\"0\"></td><td>$ARRAYdata_gallery[title]</td><td>$ARRAYdata_gallery[desc]</td><td><a href=admin_gallery.php?go=delalbumpic&id=$ARRAYdata_gallery[id] style=text-decoration:none;>< delete ></a></td></tr>";			$no++;		}		echo"</table>";	}?>